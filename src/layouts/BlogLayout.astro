---
import { config } from "../config";
import { processArticleDate } from "../lib/utils";
import type { ArticleFrontmatter } from "../lib/types";
import Section from "../components/common/Section.astro";
import Prose from "../components/Prose.astro";
import SEO from "../components/SEO.astro";
import Layout from "./Layout.astro";

type Props = { frontmatter: ArticleFrontmatter };

const { frontmatter } = Astro.props;
const articleDate = processArticleDate(frontmatter.timestamp);
const isoDate = frontmatter.timestamp.toISOString();
const canonicalUrl = new URL(`/blog/${frontmatter.slug}`, Astro.site).href;
const pageTitle = `${frontmatter.title} \u2022 ${config.personal.name}`;
---

<Layout>
  <Fragment slot="head">
    <SEO
      title={pageTitle}
      description={frontmatter.description}
      longDescription={frontmatter.longDescription}
      cardImage={frontmatter.cardImage}
      keywords={frontmatter.tags}
      canonicalUrl={canonicalUrl}
      type="article"
      publishedTime={isoDate}
      authorName={config.personal.name}
    />
  </Fragment>
  <Section wide class="pt-8">
    <article>
      <header class="mt-8 mb-16 border-b border-neutral-300 pb-8 dark:border-neutral-700">
        <h1
          class="font-display text-2xl leading-normal sm:text-3xl sm:leading-normal"
        >
          {frontmatter.title}
        </h1>
        <div class="mt-4 flex items-center gap-2 text-sm text-neutral-500">
          <time datetime={isoDate}>{articleDate}</time>
          {frontmatter.readTime && (
            <>
              <span>&middot;</span>
              <span>{frontmatter.readTime} min read</span>
            </>
          )}
        </div>
        {frontmatter.tags && frontmatter.tags.length > 0 && (
          <div class="mt-4 flex flex-wrap gap-2">
            {frontmatter.tags.map((t: string) => (
              <span class="tag">{t}</span>
            ))}
          </div>
        )}
      </header>
      <Prose>
        <slot />
      </Prose>
      <footer class="mt-16 border-t border-neutral-300 pt-8 dark:border-neutral-700">
        <p class="font-mono text-sm text-neutral-500">~{config.personal.name}</p>
      </footer>
    </article>
  </Section>
</Layout>
